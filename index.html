<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OpenCV + WASM Project: SolarWind1956</title>
</head>
<body>
    <h1>–ü—Ä–æ–µ–∫—Ç –°–µ—Ä–≥–µ—è –ì–µ–∫–∫–µ–ª—è: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∏–¥–∏–π (WASM)</h1>
    <p id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è C++...</p>
    <canvas id="canvasOutput"></canvas>
    <!-- –†–∞–∑–º–µ—â–∞–µ–º —Ñ–æ—Ç–æ –º–∏–¥–∏–π (–∑–∞–º–µ–Ω–∏—Ç–µ mussels.jpg –Ω–∞ –≤–∞—à–µ –∏–º—è —Ñ–∞–π–ª–∞) -->
    <img id="musselImage" src="data/mussel.jpg" width="640" height="480" style="border: 2px solid #333;">
    <br><br>
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ -->
    <button onclick="runMusselAnalysis()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
		üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∏–¥–∏–π
    </button>
	
<!-- –ú–µ—Å—Ç–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
<h2 id="resultOutput" style="color: darkblue;">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞...</h2>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –í–ê–® —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, –∞ –Ω–µ opencv.js -->
    <script src="index.js"></script>

    <script>
		// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∫–æ—Ç–æ—Ä—É—é Emscripten —Ç–æ—á–Ω–æ –Ω–∞–ø–æ–ª–Ω–∏—Ç
		var Module = {
			onRuntimeInitialized: function() {
				console.log("üöÄ OpenCV WASM –ú–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!");
			}
		};

		function runMusselAnalysis() {
			const img = document.getElementById('musselImage');
			const canvas = document.createElement('canvas');
			const ctx = canvas.getContext('2d');
			canvas.width = 640; canvas.height = 480;
			ctx.drawImage(img, 0, 0, 640, 480);

			const pixels = ctx.getImageData(0, 0, 640, 480).data;
			const ptr = Module._malloc(pixels.length);
			Module.HEAPU8.set(pixels, ptr);

			const mon = new Module.EcoMonitor();
			
			// --- –í–û–¢ –û–ù–ê, –ú–ê–ì–ò–Ø ---
			const result = mon.processFrame(ptr, 640, 480); 
			// –¢–µ–ø–µ—Ä—å –≤ ptr –ª–µ–∂–∞—Ç —É–∂–µ –Ω–µ –º–∏–¥–∏–∏, –∞ –∏—Ö –∫–æ–Ω—Ç—É—Ä—ã!
			
			// –ó–∞–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –ø–∞–º—è—Ç–∏ WASM –∏ –≤—ã–≤–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω
			const resultImageData = new ImageData(
				new Uint8ClampedArray(Module.HEAPU8.buffer, ptr, pixels.length), 
				640, 480
			);
			
			// –†–∏—Å—É–µ–º –∫–æ–Ω—Ç—É—Ä—ã –ø—Ä—è–º–æ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–∏–ª–∏ –Ω–∞ –Ω–æ–≤—ã–π canvas)
			ctx.putImageData(resultImageData, 0, 0);
			document.body.appendChild(canvas); // –î–æ–±–∞–≤–∏—Ç —á–µ—Ä–Ω–æ-–±–µ–ª—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			// -----------------------

			console.log(result);
			Module._free(ptr);
		}

    </script>
</body>
</html>

